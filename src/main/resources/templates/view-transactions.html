<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<link rel="stylesheet" href="/view-transactions.css">
<meta charset="UTF-8">
<title>Transactions</title>
</head>
<style>
table {
	width: 100%;
	border-collapse: collapse;
}

th, td {
	padding: 8px;
	text-align: left;
	border-bottom: 1px solid #ddd;
}

tr:hover {
	background-color: #f5f5f5;
}
</style>
<body>
	<div class="linkContainerSideBar" id="sidebar">
		<div class="sidebarHeader">
			<p id="sidebarHeader">SwipeSmart</p>
		</div>
		<div class="sidebarLinks">
			<div class="profile">
				<a id="profile" th:href="@{/users/{id}(id=${user.userId})}">Profile
					Page</a>
			</div>
			<div class="dashboard">
				<a id="dashboard" href="/dashboard">Dashboard</a>
			</div>
			<div class="cards">
				<a class="cardsText" id="cards" href="/userCards">Cards</a>
			</div>
			<div class="accounts">
				<a class="accountsText" id="accounts" href="/bankaccount/dashboard">Accounts</a>
			</div>
			<div class="logout">
				<a id="logout" href="/logout">Logout</a>
			</div>
		</div>
	</div>
	<div class="mainPage" id="main">
		<button class="openSidebar">â˜°</button>
		<div class="creditCard" id="sidebarChecker"
			th:if="${creditCard != null}">
			<div class="creditCardDetails">
				<h2 th:text="${creditCard.cardType}"></h2>
				<p th:text="${creditCard.creditCardNumber}"></p>
				<p th:text="${creditCard.pin}"></p>
				<p> Amount Used: </p>
				<p th:text="'$' + ${#numbers.formatDecimal(creditCard.amountUsed,0,'COMMA',2,'POINT')}">></p>
				<p> Statement Balance: </p>
				<p th:text="'$' + ${#numbers.formatDecimal(creditCard.monthlyBalance,0,'COMMA',2,'POINT')}"></p> 
			</div>
		</div>

		<div class="account" th:if="${account != null}">
			<div class="accountDetails">
				<h2 th:text="${account.accountName}"></h2>
				<p> Bank Account Number: </p>
				<p th:text="${account.accountNumber}"></p>
				<p> Bank Account Balance: </p>
				<p th:text="'$' + ${#numbers.formatDecimal(account.balance,0,'COMMA',2,'POINT')}"></p>
			</div>
		</div>
		<div class="transactionTable">
			<h3>Transactions</h3>
			<form th:action="@{/viewTransactions}" method="post">
				<label for="month">Month:</label> 
				<input type="month" id="month" name="month"> 
				<input type="hidden" id="accountId" name="accountId" th:if="${account != null}" th:value="${account.accountId}"> 
				<input type="hidden" id="creditCardId" name="creditCardId" th:if="${creditCard != null}" th:value="${creditCard.creditCardId}">
				<button type="submit">Filter</button>
			</form>
			<div th:if="${creditCard != null}">
				<div class="secondary-content-container">
					<table>
						<thead>
							<tr>
								<th>Category</th>
								<th>Date</th>
								<th>Time</th>
								<th>Transaction Amount in SGD</th>
								<th>Transaction Currency</th>
								<th>Transaction Type</th>
								<th>CashBack</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="transaction : ${transactions}">
								<td	th:text="${transaction.transactionMerchantCategoryCode.getMerchantCategory()}"></td>
								<td th:text="${#strings.substring(transaction.transactionDate, 0, 10)}"></td>
								<td th:text="${#strings.substring(transaction.transactionDate, 11, 19)}"></td>
								<td th:if="${transaction.transactionType == 'CC Bill Payment'}" th:text="'-$' + ${#numbers.formatDecimal(transaction.transactionAmount,0,'COMMA',2,'POINT')}"></td>
								<td th:unless="${transaction.transactionType == 'CC Bill Payment'}" th:text="'$' + ${#numbers.formatDecimal(transaction.transactionAmount,0,'COMMA',2,'POINT')}"></td>
								<td th:if="${transaction.getTransactionCurrency != null}" th:text="${transaction.getTransactionCurrency.getName}"></td>
								<td th:text="${transaction.transactionType}"></td>
								<td th:text="${#numbers.formatDecimal(transaction.cashback,1,'COMMA',2,'POINT')}"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div th:if="${account != null}">
				<div class="secondary-content-container">
					<table>
						<thead>
							<tr>
								<th>Transaction Type</th>
								<th>Date</th>
								<th>Time</th>
								<th>Transaction Amount in SGD</th>
								<th>Bank Account Number</th>
								<th>Transaction Currency</th>
								<th>External Account Number In Transaction</th>
							</tr>
						</thead>
						<tbody>
						    <tr th:each="transaction : ${transactions}">
						        <td th:text="${transaction.transactionType}"></td>
						        <td th:text="${#strings.substring(transaction.transactionDate, 0, 10)}"></td>
						        <td th:text="${#strings.substring(transaction.transactionDate, 11, 19)}"></td>
						        <td th:text="${transaction.transactionAmount}"></td>
						        <td th:unless="${transaction.transactionAccount == null}">
						            <span th:text="${#strings.length(transaction.transactionAccount.accountNumber) >= 3 ? '***-***-' + #strings.substring(transaction.transactionAccount.accountNumber, #strings.length(transaction.transactionAccount.accountNumber) - 3) : transaction.transactionAccount.accountNumber}"></span>
						        </td>
						        <td th:if="${transaction.getTransactionCurrency != null}" th:text="${transaction.getTransactionCurrency.getName}"></td>
						        <td th:unless="${transaction.recipientAccountNumber == null}">
						            <span th:text="${#strings.length(transaction.recipientAccountNumber) >= 3 ? '***-***-' + #strings.substring(transaction.recipientAccountNumber, #strings.length(transaction.recipientAccountNumber) - 3) : transaction.recipientAccountNumber}"></span>
						        </td>
						        <td th:if="${transaction.recipientAccountNumber == null}" colspan="2"></td>
						    </tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	<script>
			let menuOpen = false;
			const sidebar = document.querySelector('.linkContainerSideBar');
			const mainpage = document.querySelector('.mainPage');
			const button = document.querySelector('.openSidebar')
			
			button.addEventListener('click', () => {menuOpen = !menuOpen;
			mainpage.style.marginLeft = menuOpen ? '0' : '200px';
			sidebar.style.width = menuOpen ? '0' : '200px';})
			function checker(){
				var element = document.getElementById('sidebarChecker');
				if (element === null){
					const border = document.querySelector('.accounts');
					const word = document.querySelector('.accountsText');
					border.style.backgroundColor = "white";
					word.style.color = "black";
				}
				else{
					const border = document.querySelector('.cards');
					const word = document.querySelector('.cardsText');
					border.style.backgroundColor = "white";
					word.style.color = "black";
				}
			}
			window.onload = checker;
		</script>
</body>
</html>