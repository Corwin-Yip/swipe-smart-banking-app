<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<link rel="stylesheet" href="/dashboard.css">
		<meta charset="UTF-8">
  		<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://kit.fontawesome.com/87c4d319f6.js" crossorigin="anonymous"></script>
		<title>User Dashboard</title>
	</head>
	<body>
		<!-- side bar -->
		<div class="linkContainerSideBar" id="sidebar">
			<div class="sidebarHeader">
				<p id="sidebarHeader" >SwipeSmart</p>
			</div>
			<div class="sidebarLinks">
				<div class="profile">
					<a id="profile" th:href="@{/users/{id}(id=${user.userId})}">Profile Page</a>
				</div>
				<div class="dashboard">
					<a id="dashboard" href="/dashboard">Dashboard</a>
				</div>
				<div class="cards">
					<a id="cards" href="/userCards">Cards</a>
				</div>
				<div class="accounts">
					<a id="accounts" href="/bankaccount/dashboard">Accounts</a>
				</div>
				<div class="logout">
					<a id="logout" href="/logout">Logout</a>
				</div>
			</div>
		</div>
        
		<!-- dashboard -->
		<div class="mainPage" id="main">
            <header>
              <button class="openSidebar">â˜°</button>
            </header>
			
			<h1 th:text="'Hello ' + ${user.username} + ','"></h1>
			<p id="headerIntro"> This is for you, at a glance: </p>	
			
			<div class="summary-container">
			<div class="accounts-summary" >
				<div class="view-details-button">
					<h4>Your Accounts:</h4>
					<button id="view-account-number" onclick="toggleAccountNumber()"><i class="fa-solid fa-eye" style="font-size:20px;"></i></button>
				</div>
				<div class="account-details" th:each="account : ${user.accounts}" th:object=${user}>
					<div th:if="${account.getAccountStatus.getStatusName == 'Approved'}">
						<div class="details-account-name">
							<p th:text="${account.accountName}"></p>
						</div>
						<div class="details-account-number">
							<p class="hide-account-number" th:text="'***-***-' + ${#strings.substring(account.accountNumber, account.accountNumber.length() - 3)}"></p>
							<p style="display:none" class="show-account-number" th:text="${account.accountNumber}"></p>
						</div>
						<div class="details-account-balance">
							<label class="detail-label">Balance </label>
							<p th:text="'$' + ${#numbers.formatDecimal(account.balance,0,'COMMA',2,'POINT')}"></p>
						</div>
					</div>
					<div th:if="${account.getAccountStatus.getStatusName != 'Approved'}">
						<div class="details-account-name">
							<p th:text="${account.accountName}"></p>
						</div>
						<div class="details-account-name">
							<p style="color:red" th:text="${account.getAccountStatus.getStatusName}"></p>
						</div>
					</div>
				</div>
			</div>

				<div class="cards-summary" >
					<div class="view-details-button">
						<h4>Your Cards:</h4>
						<button id="view-card-number" onclick="toggleCardNumber()"><i class="fa-solid fa-eye" style="font-size:20px;"></i></button>
					</div>
					<div class="card-details" th:each="card: ${user.creditCards}" th:object="${user}">
						<div th:if="${card.getCreditCardStatus.getStatusName == 'Approved'}">
							<div class="details-card-type">
								<p th:text="${card.cardType}"></p>
							</div>
							<div class="details-card-number">
								<p class="hide-card-number" th:text="'****-****-****-' + ${#strings.substring(card.creditCardNumber, card.creditCardNumber.length() - 4)}"></p>
								<p style="display:none" class="show-card-number" th:text="${card.creditCardNumber}"></p>
							</div>
							<div class="details-card-limit">
								<label class="detail-label">Card Limit</label>
								<p th:if="${card.cardLimit != 0}" id="cardDetails" th:text="'$' + ${#numbers.formatDecimal(card.cardLimit,0,'COMMA',2,'POINT')}"></p>
	                         	<p th:if="${card.cardLimit == 0}" id="cardDetails" th:text="'$0.00'"></p>
							</div>
							<div class="details-card-amount">
								<label class="detail-label">Amount Used</label>
								<p th:if="${card.amountUsed != 0}" id="cardDetails" th:text="'$' + ${#numbers.formatDecimal(card.getAmountUsed,0,'COMMA',2,'POINT')}"></p>
	                         <p th:if="${card.amountUsed == 0}" id="cardDetails" th:text="'$0.00'"></p>
							</div>
						</div>
						<div th:if="${card.getCreditCardStatus.getStatusName != 'Approved'}">
							<div class="details-card-type">
								<p th:text="${card.cardType}"></p>
							</div>
							<div class="details-card-number">
								<div class="detail-label">
									<p style="color:red" th:text="${card.getCreditCardStatus.getStatusName}"></p>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="spendingInsights">
				</div>
				<div class="pieChart">
			</div>
		</div>
		</div>
		<script>
			let menuOpen = false;
			const sidebar = document.querySelector('.linkContainerSideBar');
			const mainpage = document.querySelector('.mainPage');
			const button = document.querySelector('.openSidebar')
			
			button.addEventListener('click', () => {menuOpen = !menuOpen;
			mainpage.style.marginLeft = menuOpen ? '0' : '200px';
			sidebar.style.width = menuOpen ? '0' : '200px';})
			
			function toggleAccountNumber(){
				var hiddenAccountNumbers = document.querySelectorAll('.hide-account-number');
				var shownAccountNumbers = document.querySelectorAll('.show-account-number');
				for (var i = 0; i < hiddenAccountNumbers.length; i++){
					if (shownAccountNumbers[i].style.display === 'none'){
						shownAccountNumbers[i].style.display = 'block';
						hiddenAccountNumbers[i].style.display = 'none';
					}
					else {
						shownAccountNumbers[i].style.display = 'none';
						hiddenAccountNumbers[i].style.display = 'block';
					}
				}
			}
			
			function toggleCardNumber(button){
				
				var hiddenCardNumbers = document.querySelectorAll('.hide-card-number');
				var shownCardNumbers = document.querySelectorAll('.show-card-number');
				var eyeIcons = document.querySelectorAll('.fa-eye');
				
				for (var i = 0; i < hiddenCardNumbers.length; i++){
					if (shownCardNumbers[i].style.display === 'none'){
						shownCardNumbers[i].style.display = 'block';
						hiddenCardNumbers[i].style.display = 'none';
					}
					else {
						shownCardNumbers[i].style.display = 'none';
						hiddenCardNumbers[i].style.display = 'block';
					}
				}	
				for (var j = 0; j < eyeIcons.length; j++) {
			        if (eyeIcons[j].classList.contains('fa-eye')) {
			            eyeIcons[j].classList.remove('fa-eye');
			            eyeIcons[j].classList.add('fa-eye-slash');
			        } else {
			            eyeIcons[j].classList.remove('fa-eye-slash');
			            eyeIcons[j].classList.add('fa-eye');
			        }
			    }
			}
		</script>
	</body>	
</html>